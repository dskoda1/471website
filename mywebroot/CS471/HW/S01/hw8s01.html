<!doctype html public "-//w3c//dtd html 4.0 transitional//en">
<html>
<head>
   <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
   <meta name="Author" content="E Head">
   <meta name="GENERATOR" content="Mozilla/4.76 [en] (Windows NT 5.0; U) [Netscape]">
   <meta name="Description" content="Introduction">
   <title>#8 Runtime Stack, Arrays -</title>
</head>
<body text="#000000" bgcolor="#FAFAFA" link="#FF0000" vlink="#990000" alink="#CC0000">
<a href="http://bingweb.binghamton.edu/~head/CS471/471hwIndex.html">Back</a>
<h4>
Assignment 8:&nbsp; Dur Friday, Mar 23, 2001</h4>

<h4>
Read Scott:</h4>

<ul>
<li>
pages: 373 - 378</li>

<li>
427-442</li>

<li>
Skim over 238-241</li>
</ul>

<p><br>The purpose of this assignment is to understand the runtime stack,
<br>Written assignment:
<ol>
<li>
Given the following declaration in Ada :</li>

<ol>TYPE Array_type IS ARRAY(1..5,10..14) OF Integer;
<br>TYPE CODE is record
<br>&nbsp;&nbsp;&nbsp;&nbsp; Status : CHARACTER;
<br>&nbsp;&nbsp;&nbsp;&nbsp; Salary : Integer;
<br>end record;
<br>TYPE Code_Array IS ARRAY(1..7,10..14) OF CODE;
<br>arr : Array_type;
<br>codeArr : Code_Array;</ol>

<p><br>If&nbsp;&nbsp; INTEGER requires 4 bytes of storage and CHARACTER
requires 1 byte of storage what is the effective address (using bytes as
the addressable units) of <font color="#FF0000">variables below</font>
(show your calculations) You should assume that the ba (base address) for
arr is 260 and the base address for codeArr is 2100.
<br>&nbsp;
<ol>
<ol TYPE=A>
<li>
Using row major the effective address for arr(2,11)&nbsp; is&nbsp; __________________</li>

<li>
Using column major the effective address for arr(2,11)&nbsp; is&nbsp; __________________</li>

<li>
Using row major the effective address for codeArr(2,10) is&nbsp; __________________</li>

<li>
Using row major the effective address for codeArr(2.10).Salary is&nbsp;
__________________</li>

<ol TYPE=A>&nbsp;</ol>
</ol>
</ol>

<li>
What is the difference between macros and routines?&nbsp; Explain in terms
of the concept of binding.</li>

<li>
Compile and run in gcc&nbsp; the following C code on two different systems:</li>

<ol><b><tt>int loop() {</tt></b>
<br><b><tt>&nbsp; int x[512];</tt></b>
<br><b><tt>&nbsp; int i=0;</tt></b>
<br><b><tt>&nbsp; while (i++ &lt;512) {</tt></b>
<br><b><tt>&nbsp;&nbsp;&nbsp;&nbsp; x[i] = 0;</tt></b>
<br><b><tt>&nbsp; }</tt></b>
<br><b><tt>}</tt></b>
<p><b><tt>int main () {</tt></b>
<br><b><tt>&nbsp; printf("\nCalling loop&nbsp; -->>\n");</tt></b>
<br><b><tt>&nbsp; loop();</tt></b>
<br><b><tt>}</tt></b></ol>

<p><br>Below are the commands to compile and run the above code on Cygwin
and Sun systems:
<br>(PC)
<ol><b><tt>gcc -ansi <a href="http://bingweb.binghamton.edu/~head/CS471/HW/hw8s01.c">hw8s01.c</a>
-o hw8s01.exe</tt></b>
<br><b><tt>hw8s01.exe</tt></b>
<p><b><font color="#3333FF">if hw8s01.exe does NOT work then type:</font></b>
<br><b><tt><font color="#3333FF">./hw8s01.exe</font></tt></b>
<br>&nbsp;</ol>
(Bingsuns )
<ol><b><tt>gcc -ansi <a href="http://bingweb.binghamton.edu/~head/CS471/HW/hw8s01.c">hw8s01.c</a>
-o hw8s01</tt></b>
<br><b><tt>hw8s01</tt></b></ol>
Using the -S option look at the assembly code.&nbsp; Do not use a debugger.
<ol>
<ol TYPE=A>
<li>
What happens when you run this code?</li>

<li>
Depending on the target machine and the compiler, this code will excute
differently.&nbsp; Sometimes this code goes into an infinite loop, sometimes
this code terminates, sometimes this code cause a segmentation error.&nbsp;
Can you explain why this code does not behavior consistently?&nbsp; Think
in terms of the AR and the runtime stack.</li>
</ol>
</ol>

<ol>&nbsp;</ol>

<li>
For the following C3 program fragment, show the snapshot of the run-time
stack at&nbsp; each critical stage until the code returns to main...&nbsp;
In particular, show the static and dynamic links before each call.&nbsp;
( Follow the <a href="http://bingweb.binghamton.edu/~head/CS471/NOTES/RUNTIME/2stack.gif">presentation
of run-times environment stack in class notes</a>.)</li>

<ol><tt>int i = 3, j = 2, k = 1;</tt>
<br><tt>&nbsp;&nbsp; void beta(<font color="#3333FF">void</font> );</tt>
<p><tt>&nbsp;&nbsp;&nbsp;<font color="#990000"> int alpha(int x )</font>{</tt>
<br><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; int j = 4;</tt>
<br><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ....&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
//++ </tt>&lt;&lt;&lt;&lt;&lt;&lt; Show stack here
<br><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; j += k = k + x;</tt>
<p><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; beta( );</tt>
<br><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ....&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
// </tt>&lt;&lt;&lt;&lt;&lt;&lt; Show stack here
<ol>
<ol><tt>return j;</tt></ol>
</ol>
<tt>&nbsp;&nbsp;&nbsp; };</tt>
<p><tt>&nbsp;&nbsp;&nbsp;&nbsp; <font color="#3333FF">void</font> beta(<font color="#3333FF">void</font>
){</tt>
<br><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; int x = 9;</tt>
<br><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ....&nbsp;&nbsp;&nbsp;&nbsp;
//</tt>&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&nbsp; show the stack
here after call from callee
<br><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#000000">if
(j>3) return;&nbsp; //Termination</font></tt>
<br><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; j = i + x;</tt>
<p><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; alpha(5);</tt>
<br><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ....&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</tt>
//&lt;&lt;&lt;&lt;&lt; after returned from alpha
<ol>
<ol><tt>return;</tt></ol>
</ol>
<tt>&nbsp;&nbsp;&nbsp; };</tt>
<p><tt>&nbsp;&nbsp;&nbsp; int main( ){</tt>
<ol>
<ol><tt>int i = 30;</tt></ol>
</ol>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ....&nbsp; // ** </tt>stack
before beta is called
<br><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; beta( );</tt>
<br><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
// *** </tt>stack after beta is returned
<br><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ....</tt>
<ol>
<ol><tt>return i;</tt></ol>
</ol>
<tt>&nbsp;&nbsp;&nbsp; }</tt></ol>
</ol>

<table BORDER BGCOLOR="#FFF8F0" >
<tr ALIGN=CENTER BGCOLOR="#FFFFC4">
<td>
<center>Description</center>
</td>

<td>D addr</td>

<td>
<center>main **</center>
</td>

<td>
<center>beta 1</center>
</td>

<td>alpha1 ++</td>

<td>
<center>beta 2</center>
</td>

<td>
<center>alpha1 +++</center>
</td>

<td>
<center>beta1</center>
</td>

<td>
<center>main ***</center>
</td>
</tr>

<tr>
<td></td>

<td></td>

<td BGCOLOR="#D7FFD7">Just</td>

<td BGCOLOR="#D7FFD7">after</td>

<td BGCOLOR="#D7FFD7">calling</td>

<td BGCOLOR="#D7FFD7">function</td>

<td BGCOLOR="#EEF0F9">Just&nbsp;</td>

<td BGCOLOR="#EEF0F9">after&nbsp;</td>

<td BGCOLOR="#EEF0F9">return to function</td>
</tr>

<tr BGCOLOR="#FFE4CA">
<td>
<center>Current</center>
</td>

<td>
<center>0</center>
</td>

<td>
<center>0</center>
</td>

<td>
<center>&nbsp;</center>
</td>

<td>&nbsp;</td>

<td>
<center>&nbsp;</center>
</td>

<td>
<center>&nbsp;</center>
</td>

<td>
<center>&nbsp;</center>
</td>

<td>
<center>&nbsp;</center>
</td>
</tr>

<tr BGCOLOR="#FFE4CA">
<td>
<center>Free</center>
</td>

<td>
<center>1</center>
</td>

<td>
<center>7</center>
</td>

<td>&nbsp;</td>

<td>&nbsp;</td>

<td>
<center>&nbsp;</center>
</td>

<td>
<center>&nbsp;</center>
</td>

<td>
<center>&nbsp;</center>
</td>

<td>
<center>&nbsp;</center>
</td>
</tr>

<tr>
<td>
<center>global&nbsp; <b><i>i</i></b></center>
</td>

<td>
<center>2</center>
</td>

<td>
<center>3</center>
</td>

<td>
<center>&nbsp;</center>
</td>

<td>&nbsp;</td>

<td>
<center>&nbsp;</center>
</td>

<td>
<center>&nbsp;</center>
</td>

<td>
<center>&nbsp;</center>
</td>

<td>
<center>&nbsp;</center>
</td>
</tr>

<tr>
<td>
<center>global&nbsp; <b><i>j</i></b></center>
</td>

<td>
<center>3</center>
</td>

<td>
<center>2</center>
</td>

<td>
<center>&nbsp;</center>
</td>

<td>&nbsp;</td>

<td>
<center>&nbsp;</center>
</td>

<td>
<center>&nbsp;</center>
</td>

<td>
<center>&nbsp;</center>
</td>

<td>
<center>&nbsp;</center>
</td>
</tr>

<tr>
<td>
<center>global <b><i>k</i></b></center>
</td>

<td>
<center>4</center>
</td>

<td>
<center>1</center>
</td>

<td>
<center>&nbsp;</center>
</td>

<td>&nbsp;</td>

<td>
<center>&nbsp;</center>
</td>

<td>
<center>&nbsp;</center>
</td>

<td>
<center>&nbsp;</center>
</td>

<td>
<center>&nbsp;</center>
</td>
</tr>

<tr BGCOLOR="#EFF0EE">
<td>
<center>return value</center>
</td>

<td>
<center>5</center>
</td>

<td>
<center>&nbsp;?</center>
</td>

<td>&nbsp;</td>

<td>&nbsp;</td>

<td>&nbsp;</td>

<td>&nbsp;</td>

<td>&nbsp;</td>

<td>&nbsp;</td>
</tr>

<tr BGCOLOR="#EFF0EE">
<td>
<center>&nbsp;main <b><i>i</i></b></center>
</td>

<td>
<center>6</center>
</td>

<td>
<center>&nbsp;30</center>
</td>

<td>&nbsp;</td>

<td>&nbsp;</td>

<td>&nbsp;</td>

<td>&nbsp;</td>

<td>&nbsp;</td>

<td>&nbsp;</td>
</tr>

<tr>
<td>&nbsp;</td>

<td>
<center>7</center>
</td>

<td>&nbsp;</td>

<td>&nbsp;</td>

<td>&nbsp;</td>

<td>&nbsp;</td>

<td>&nbsp;</td>

<td>&nbsp;</td>

<td>&nbsp;</td>
</tr>

<tr>
<td>&nbsp;</td>

<td>
<center>8</center>
</td>

<td>&nbsp;</td>

<td>&nbsp;</td>

<td>&nbsp;</td>

<td>&nbsp;</td>

<td>&nbsp;</td>

<td>&nbsp;</td>

<td>&nbsp;</td>
</tr>

<tr>
<td>&nbsp;</td>

<td>
<center>9</center>
</td>

<td>&nbsp;</td>

<td>&nbsp;</td>

<td>&nbsp;</td>

<td>&nbsp;</td>

<td>&nbsp;</td>

<td>&nbsp;</td>

<td>&nbsp;</td>
</tr>

<tr>
<td>&nbsp;</td>

<td>
<center>10</center>
</td>

<td>&nbsp;</td>

<td>&nbsp;</td>

<td>&nbsp;</td>

<td>&nbsp;</td>

<td>&nbsp;</td>

<td>&nbsp;</td>

<td>&nbsp;</td>
</tr>

<tr>
<td>&nbsp;</td>

<td>
<center>11</center>
</td>

<td>&nbsp;</td>

<td>&nbsp;</td>

<td>&nbsp;</td>

<td>&nbsp;</td>

<td>&nbsp;</td>

<td>&nbsp;</td>

<td>&nbsp;</td>
</tr>

<tr>
<td>&nbsp;</td>

<td>
<center>12</center>
</td>

<td>&nbsp;</td>

<td>&nbsp;</td>

<td>&nbsp;</td>

<td>&nbsp;</td>

<td>&nbsp;</td>

<td>&nbsp;</td>

<td>&nbsp;</td>
</tr>

<tr>
<td>&nbsp;</td>

<td>
<center>13</center>
</td>

<td>&nbsp;</td>

<td>&nbsp;</td>

<td>&nbsp;</td>

<td>&nbsp;</td>

<td>&nbsp;</td>

<td>&nbsp;</td>

<td>&nbsp;</td>
</tr>

<tr>
<td>&nbsp;</td>

<td>
<center>14</center>
</td>

<td>&nbsp;</td>

<td>&nbsp;</td>

<td>&nbsp;</td>

<td>&nbsp;</td>

<td>&nbsp;</td>

<td>&nbsp;</td>

<td>&nbsp;</td>
</tr>

<tr>
<td>&nbsp;</td>

<td>
<center>15</center>
</td>

<td>&nbsp;</td>

<td>&nbsp;</td>

<td>&nbsp;</td>

<td>&nbsp;</td>

<td>&nbsp;</td>

<td>&nbsp;</td>

<td>&nbsp;</td>
</tr>

<tr>
<td>&nbsp;</td>

<td>
<center>16</center>
</td>

<td>&nbsp;</td>

<td>&nbsp;</td>

<td>&nbsp;</td>

<td>&nbsp;</td>

<td>&nbsp;</td>

<td>&nbsp;</td>

<td>&nbsp;</td>
</tr>

<tr>
<td>&nbsp;</td>

<td>
<center>17</center>
</td>

<td>&nbsp;</td>

<td>&nbsp;</td>

<td>&nbsp;</td>

<td>&nbsp;</td>

<td>&nbsp;</td>

<td>&nbsp;</td>

<td>&nbsp;</td>
</tr>

<tr>
<td>&nbsp;</td>

<td>
<center>18</center>
</td>

<td>&nbsp;</td>

<td>&nbsp;</td>

<td>&nbsp;</td>

<td>&nbsp;</td>

<td>&nbsp;</td>

<td>&nbsp;</td>

<td>&nbsp;</td>
</tr>

<tr>
<td>&nbsp;</td>

<td>
<center>19</center>
</td>

<td>&nbsp;</td>

<td>&nbsp;</td>

<td>&nbsp;</td>

<td>&nbsp;</td>

<td>&nbsp;</td>

<td>&nbsp;</td>

<td>&nbsp;</td>
</tr>

<tr>
<td>&nbsp;</td>

<td>
<center>20</center>
</td>

<td>&nbsp;</td>

<td>&nbsp;</td>

<td>&nbsp;</td>

<td>&nbsp;</td>

<td>&nbsp;</td>

<td>&nbsp;</td>

<td>&nbsp;</td>
</tr>

<tr>
<td>&nbsp;</td>

<td>
<center>21</center>
</td>

<td>&nbsp;</td>

<td>&nbsp;</td>

<td>&nbsp;</td>

<td>&nbsp;</td>

<td>&nbsp;</td>

<td>&nbsp;</td>

<td>&nbsp;</td>
</tr>

<tr>
<td>&nbsp;</td>

<td>
<center>22</center>
</td>

<td>&nbsp;</td>

<td>&nbsp;</td>

<td>&nbsp;</td>

<td>&nbsp;</td>

<td>&nbsp;</td>

<td>&nbsp;</td>

<td>&nbsp;</td>
</tr>

<tr>
<td>&nbsp;</td>

<td>
<center>23</center>
</td>

<td>&nbsp;</td>

<td>&nbsp;</td>

<td>&nbsp;</td>

<td>&nbsp;</td>

<td>&nbsp;</td>

<td>&nbsp;</td>

<td>&nbsp;</td>
</tr>

<tr>
<td>&nbsp;</td>

<td>
<center>24</center>
</td>

<td>&nbsp;</td>

<td>&nbsp;</td>

<td>&nbsp;</td>

<td>&nbsp;</td>

<td>&nbsp;</td>

<td>&nbsp;</td>

<td>&nbsp;</td>
</tr>
</table>

<ol START=5>
<li>
DO NOT TURN IN:&nbsp; How would the runtime stack change to the above problem
if the <i><tt>main</tt></i> was change to:&nbsp; (Note: there would be
more columns.)</li>

<ol><tt>&nbsp;int main( ){</tt>
<ol><tt>int i = 30;</tt></ol>
</ol>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ....</tt>
<br><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; beta( );</tt>
<br><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ....</tt>
<ol>
<ol><tt>j = 3;</tt>
<br><tt>beta( );</tt>
<br><tt>....</tt>
<br><tt>return i;</tt></ol>
</ol>
<tt>&nbsp;&nbsp;&nbsp; }</tt>
<br>&nbsp;
<br>&nbsp;
<br>&nbsp;
<br>&nbsp;
<br>&nbsp;
<br>&nbsp;
<br>&nbsp;</ol>

<br>&nbsp;
<br>&nbsp;
<br>&nbsp;
<br>&nbsp;
<br>&nbsp;
<br>&nbsp;
<br>&nbsp;
<br>&nbsp;
<br>&nbsp;
<br>&nbsp;
<br>&nbsp;
<br>&nbsp;
<br>&nbsp;
<br>&nbsp;
<br>&nbsp;
<br>&nbsp;
<ol><font color="#3333FF">I collaborated with : ___________________________________</font>
<p><font color="#3333FF">Resources use: _______________________________________</font></ol>

<br>&nbsp;
<br>&nbsp;
<p><a href="mailto:head@binghamton.edu">Questions?(For E. Head)</a>
</body>
</html>
